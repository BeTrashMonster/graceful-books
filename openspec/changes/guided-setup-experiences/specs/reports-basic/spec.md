# Basic Reports (P&L and Balance Sheet) - Capability Specification

**Capability ID:** `reports-basic`
**Related Roadmap Items:** D6, D7
**SPEC Reference:** ACCT-009
**Status:** In Development

## Overview

The Basic Reports capability provides essential financial statements—Profit & Loss (Income Statement) and Balance Sheet—with plain English explanations to help users understand their business financial health. These reports transform accounting data into actionable insights.

## ADDED Requirements

### Functional Requirements

#### FR-1: Profit & Loss Report (Income Statement)
**Priority:** Critical

The P&L report SHALL display:

**Report Structure:**
- **Income Section:**
  - Revenue accounts (all INCOME type)
  - Other Income
  - Total Income
- **Cost of Goods Sold (COGS):**
  - COGS accounts
  - Total COGS
- **Gross Profit:**
  - Total Income - Total COGS
  - Gross Profit Margin (%)
- **Expenses Section:**
  - Operating Expenses (categorized)
  - Other Expenses
  - Total Expenses
- **Net Profit:**
  - Gross Profit - Total Expenses
  - Net Profit Margin (%)

**Date Range Options:**
- This Month
- Last Month
- This Quarter
- Last Quarter
- This Year
- Last Year
- Custom Range (date picker)

**Comparison Options:**
- None (current period only)
- Previous Period (automatic calculation)
- Same Period Last Year
- Custom Comparison Period

**Acceptance Criteria:**
- [ ] Report accurate to the penny
- [ ] All account types categorized correctly
- [ ] Date range selection intuitive
- [ ] Comparison columns align properly
- [ ] Negative numbers displayed clearly (red or parentheses)

#### FR-2: Balance Sheet Report
**Priority:** Critical

The Balance Sheet SHALL display:

**Report Structure:**
- **Assets:**
  - Current Assets (Cash, AR, Inventory)
  - Fixed Assets (Equipment, Property)
  - Other Assets
  - **Total Assets**
- **Liabilities:**
  - Current Liabilities (AP, Credit Cards, Short-term Loans)
  - Long-term Liabilities (Mortgages, Long-term Loans)
  - **Total Liabilities**
- **Equity:**
  - Owner's Equity / Retained Earnings
  - Current Year Profit/Loss
  - **Total Equity**
- **Balance Verification:**
  - Assets = Liabilities + Equity (must always be true)

**As-Of Date:**
- Today
- End of Last Month
- End of Last Quarter
- End of Last Year
- Custom Date

**Acceptance Criteria:**
- [ ] Balance equation always true (Assets = Liabilities + Equity)
- [ ] Current vs. long-term classification correct
- [ ] As-of date calculation accurate
- [ ] Report reflects all transactions up to as-of date

#### FR-3: Plain English Explanations
**Priority:** High

Both reports SHALL include educational content:

**"What Does This Mean?" Toggle:**
- Toggleable overlay/sidebar with explanations
- Section-by-section breakdown
- Examples relevant to user's business type
- Links to learning library for deeper dives

**P&L Explanations:**
- "Revenue is money you earned from customers"
- "Expenses are costs of running your business"
- "Profit is what's left after expenses. Positive is good!"
- "Profit Margin shows how much of each dollar you keep"

**Balance Sheet Explanations:**
- "Assets are things your business owns"
- "Liabilities are debts your business owes"
- "Equity is your ownership stake - what's truly yours"
- "The balance sheet is like a financial snapshot at one moment in time"

**Visual Indicators:**
- Profitable: Subtle green indicator, encouraging message
- Loss: Neutral indicator, supportive message (not alarming)
- Trend arrows: ↑ Revenue up, ↓ Expenses down (good or bad contextual)

**Acceptance Criteria:**
- [ ] Explanations written at 6th-8th grade reading level
- [ ] Toggle works smoothly (no page reload)
- [ ] Content DISC-adapted where applicable
- [ ] Visual indicators color-blind friendly

#### FR-4: Report Formatting & Export
**Priority:** High

Reports SHALL support:

**On-Screen Display:**
- Clean, professional layout
- Responsive design (mobile/tablet/desktop)
- Print-friendly view
- Currency formatting ($1,234.56)
- Percentage formatting (15.5%)

**Export Options:**
- **PDF:** Professional formatting with company logo
- **CSV:** Machine-readable for Excel/Google Sheets
- **Print:** Direct print with proper page breaks

**PDF Features:**
- Company name and logo (if uploaded)
- Report title and date range
- "Generated by Graceful Books" footer
- Page numbers
- Signature line (optional)

**Acceptance Criteria:**
- [ ] PDF export generates in < 5 seconds
- [ ] CSV export preserves number formatting
- [ ] Print view fits standard letter size
- [ ] Exports maintain data accuracy

#### FR-5: Comparison & Trend Analysis
**Priority:** Medium

Reports SHALL provide comparison capabilities:

**Side-by-Side Comparison:**
- Current Period vs. Previous Period
- Dollar change ($)
- Percentage change (%)
- Variance analysis

**Visual Enhancements:**
- Color-coded variance (green = favorable, red = unfavorable)
- Contextual interpretation: "Revenue increased 12% vs. last month"
- Trend indicators: ↑↑ (strong increase), ↑ (increase), → (flat), ↓ (decrease)

**Acceptance Criteria:**
- [ ] Comparison calculations accurate
- [ ] Percentage changes rounded to 1 decimal
- [ ] Variance interpretation contextually correct (expense decrease is good)
- [ ] Mobile view shows comparison without horizontal scroll

### Non-Functional Requirements

#### NFR-1: Performance
- Report generation < 2 seconds for 1000 transactions
- PDF export < 5 seconds
- Date range change < 1 second
- Supports 10,000+ transactions without timeout

#### NFR-2: Accuracy
- All calculations accurate to 2 decimal places
- Balance sheet equation always validates
- No rounding errors in totals
- Audit trail for report generation

#### NFR-3: Accessibility
- WCAG 2.1 AA compliant
- Screen reader announces report structure
- Keyboard navigation for all controls
- High contrast mode supported
- Report data available as accessible table

## Design Considerations

### User Experience

**Report Access Flow:**
```
[Dashboard]
    → [Reports Menu]
    → [Select: P&L or Balance Sheet]
    → [Date Range Selection]
    → [Report Displays]
    → [Optional: Toggle Explanations]
    → [Optional: Compare to Previous Period]
    → [Export or Print]
```

**First Report Experience:**
```
[User Clicks "Reports"]
    → [Tutorial Tooltip: "Reports show your financial health"]
    → [P&L Selected by Default]
    → [This Month Selected]
    → [Report Generates]
    → [Celebration: "Your first P&L report! You can now see if you're profitable."]
    → [Explanation Toggle Highlighted]
    → ["Want to understand what you're looking at? Click here!"]
```

**Joy Opportunities:**
- First report: "Your first report! You're officially doing business analytics."
- Profitable: "You made money this period! Great work." (subtle green glow)
- Revenue milestone: "$10,000 in revenue this month! New record!"
- Expense control: "Expenses down 8% vs. last month. Nice cost management!"

**DISC Adaptations:**
- **D:** "Bottom line: +$2,500 profit this month"
- **I:** "Great news! You're profitable and trending up!"
- **S:** "Your business is stable. Revenue and expenses are balanced."
- **C:** "Detailed analysis: 15.5% net margin, 2.3% above target"

### Technical Architecture


**Components:**
```typescript
// New report components
ReportSelector.tsx          // P&L or Balance Sheet selector
DateRangePicker.tsx         // Date range selection UI
ProfitAndLossReport.tsx     // P&L report display
BalanceSheetReport.tsx      // Balance sheet display
ReportExplanations.tsx      // Educational overlay/sidebar
ReportComparison.tsx        // Comparison column logic
ReportExport.tsx            // PDF/CSV export controls
ReportVisualization.tsx     // Optional charts/graphs
```

**Report Calculation Engine:**
```typescript
interface ReportPeriod {
  startDate: Date;
  endDate: Date;
}

interface PLReportData {
  period: ReportPeriod;
  income: {
    revenue: number;
    otherIncome: number;
    total: number;
  };
  cogs: {
    items: AccountBalance[];
    total: number;
  };
  grossProfit: number;
  grossProfitMargin: number;
  expenses: {
    categories: Record<string, number>;
    total: number;
  };
  netProfit: number;
  netProfitMargin: number;
}

interface BalanceSheetData {
  asOfDate: Date;
  assets: {
    currentAssets: AccountBalance[];
    fixedAssets: AccountBalance[];
    otherAssets: AccountBalance[];
    total: number;
  };
  liabilities: {
    currentLiabilities: AccountBalance[];
    longTermLiabilities: AccountBalance[];
    total: number;
  };
  equity: {
    ownersEquity: number;
    retainedEarnings: number;
    currentYearPL: number;
    total: number;
  };
  balanceCheck: boolean; // Assets === Liabilities + Equity
}
```

**Report Generation Functions:**
```typescript
async function generatePLReport(
  companyId: string,
  period: ReportPeriod,
  accountingMethod: 'cash' | 'accrual' = 'cash'
): Promise<PLReportData> {
  // 1. Fetch all transactions in date range
  // 2. Group by account type (INCOME, COGS, EXPENSE)
  // 3. Sum debits and credits per account
  // 4. Calculate totals and margins
  // 5. Apply accounting method (cash vs. accrual)
  // 6. Return structured report data
}

async function generateBalanceSheet(
  companyId: string,
  asOfDate: Date
): Promise<BalanceSheetData> {
  // 1. Fetch all transactions up to asOfDate
  // 2. Calculate account balances (cumulative)
  // 3. Classify as current vs. long-term
  // 4. Calculate equity section
  // 5. Verify balance equation
  // 6. Return structured report data
}
```

**PDF Export:**
```typescript
// Using library like jsPDF or similar
async function exportPDF(
  reportType: 'pl' | 'balance-sheet',
  reportData: PLReportData | BalanceSheetData,
  companyInfo: CompanyInfo
): Promise<Blob> {
  // 1. Generate PDF with professional template
  // 2. Include company logo and info
  // 3. Format numbers and dates
  // 4. Add page breaks for long reports
  // 5. Return PDF blob for download
}
```

## Testing Strategy

### Unit Tests
- P&L calculation accuracy
- Balance Sheet calculation accuracy
- Balance equation validation
- Date range filtering
- Accounting method (cash vs. accrual)
- Number formatting

### Integration Tests
- Report generation end-to-end
- PDF export quality
- CSV export data integrity
- Comparison calculations
- Explanation content display

### User Acceptance Tests
- Generate P&L for various date ranges
- Generate Balance Sheet as-of various dates
- Verify accuracy against known test data
- Export to PDF and CSV
- Toggle explanations on/off
- Compare periods side-by-side
- Mobile responsive testing

## Open Questions

1. **Chart Integration:** Should reports include embedded charts/graphs?
   - **Decision Needed By:** UX Designer + Product Manager
   - **Impact:** Medium - affects visual appeal and comprehension

2. **Report Scheduling:** Should users be able to schedule automatic report delivery?
   - **Decision Needed By:** Product Manager
   - **Impact:** Low - future enhancement (see I6 in roadmap)

3. **Drill-Down:** Should users be able to click report lines to see transactions?
   - **Decision Needed By:** UX Designer + Product Manager
   - **Impact:** High - greatly enhances report usefulness

4. **Custom Reports:** Should we support custom report building in Phase 2?
   - **Decision Needed By:** Product Manager
   - **Impact:** Low - Phase 3 feature (G1 in roadmap)

## Success Metrics

- **Report Generation:** 90%+ of active users generate at least one report per month
- **First Report:** Average user generates first P&L within 7 days of signup
- **Understanding:** 70%+ of users use "What does this mean?" explanations
- **Export Usage:** 50%+ of reports exported to PDF
- **Profitability Awareness:** 95%+ of users can state if they were profitable last month
- **Retention Impact:** Users who review reports monthly have 2.5x higher retention

## Related Documentation

- SPEC.md § ACCT-009 (Reporting)
- SPEC.md § ACCT-010 (Cash vs. Accrual)
- ROADMAP.md Group D (D6, D7), Group F (F4 - Cash Flow Report)
- Database schema: TRANSACTIONS and TRANSACTION_LINES tables
- Report templates and styling guide
- PDF generation library documentation
